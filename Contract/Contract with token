// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";

contract SmartBondToken is ERC20 {
    address public issuer;
    uint256 public maturityDate;
    uint256 public principalAmount;
    uint256 public couponFrequencyMinutes;
    uint256 public couponAmount;
    uint256 public lastCouponPaymentTime;

    constructor(
        string memory name,
        string memory symbol,
        uint256 _totalSupply,
        uint256 _maturityDate,
        uint256 _principalAmount,
        uint256 _couponFrequencyMinutes,
        uint256 _couponAmount
    ) ERC20(name, symbol) {
        _mint(msg.sender, _totalSupply);
        issuer = msg.sender;
        maturityDate = _maturityDate;
        principalAmount = _principalAmount;
        couponFrequencyMinutes = _couponFrequencyMinutes;
        couponAmount = _couponAmount;
        lastCouponPaymentTime = block.timestamp;
    }

    function redeem() external {
        require(msg.sender == issuer, "Only the issuer can redeem the bond");
        require(block.timestamp >= maturityDate, "Bond has not matured yet");

        uint256 balance = balanceOf(issuer);
        require(balance >= principalAmount, "Insufficient balance for redemption");

        _burn(issuer, principalAmount);
    }

    function payCoupon() external {
        require(msg.sender == issuer, "Only the issuer can pay coupons");
        require(block.timestamp >= lastCouponPaymentTime + couponFrequencyMinutes * 1 minutes, "Coupon not due yet");

        uint256 balance = balanceOf(issuer);
        require(balance >= couponAmount, "Insufficient balance for coupon payment");

        transfer(issuer, couponAmount);
        lastCouponPaymentTime = block.timestamp;
    }

    function transferBond(address to, uint256 amount) external {
        require(msg.sender != issuer, "The issuer cannot transfer bonds.");
        require(block.timestamp < maturityDate, "Bonds cannot be transferred after maturity.");
        require(amount > 0, "Amount must be greater than 0.");
        require(balanceOf(msg.sender) >= amount, "Insufficient balance to transfer.");

        transfer(to, amount);
    }
}
